!function(){"use strict";angular.module("ng-sal",["http-auth-interceptor","base64","ui.router"])}(),function(){"use strict";angular.module("ng-sal").constant("ngsalConfig",{applicationName:"ngsalConfig.applicationName"})}(),function(){"use strict";function loginService($resource,authService,$rootScope,ngsalConfig){var service=$resource("/"+ngsalConfig.applicationName+"/api/authentication",{username:"@username",password:"@password"},{login:{method:"POST",isArray:!1,headers:{"Content-Type":"application/x-www-form-urlencoded"},ignoreAuthModule:"ignoreAuthModule"},logoutApi:{method:"GET",url:"/"+ngsalConfig.applicationName+"/api/logout",isArray:!0,ignoreAuthModule:"ignoreAuthModule"},authenticate:{method:"GET",url:"/"+ngsalConfig.applicationName+"/api/authenticate",isArray:!1,ignoreAuthModule:"ignoreAuthModule"},user:{method:"GET",url:"/"+ngsalConfig.applicationName+"/api/user",isArray:!1},goToPerfil:{method:"GET",url:"/"+ngsalConfig.applicationName+"/api/goToPerfil/:codigo",params:{codigo:"@codigo"},isArray:!1}}),currentUser=null;return service.getCurrentUser=function(){return currentUser},service.activateLogin=function(obj){currentUser={username:obj.username,permissions:{},userDetails:{}},service.authenticate({},function(userDetails){service.setUserDetails(userDetails),authService.loginConfirmed(obj)})},service.logout=function(data){authService.loginCancelled(data),currentUser=null,service.logoutApi(function(success){$rootScope.$broadcast("event:userLogout")})},service.setUserDetails=function(data){currentUser||(currentUser={username:data.username,permissions:{},userDetails:{}}),currentUser.userDetails=data.userDetails,currentUser.permissions=data.permissions,$rootScope.currentUser=currentUser,$rootScope.$broadcast("event:userDetailsPrepared")},service}angular.module("ng-sal").factory("loginService",loginService),loginService.$inject=["$resource","authService","$rootScope","ngsalConfig"]}(),function(){"use strict";function loginController($scope,loginService,authService,$document,$sanitize,$base64){function sanitizeCredentials(){return{username:$sanitize($scope.username),password:$base64.encode($sanitize($scope.password)),ignoreAuthModule:"ignoreAuthModule"}}function limpaForm(){$scope.username=null,$scope.password=null}$scope.authenticationError=!1,$scope.submit=function(){$scope.authenticationError=!1,loginService.login(sanitizeCredentials(),function(data){loginService.activateLogin(data),limpaForm()},function(data){loginService.logout(data),limpaForm(),$scope.authenticationError=!0})}}angular.module("ng-sal").controller("loginController",loginController),loginController.$inject=["$scope","loginService","authService","$document","$sanitize","$base64"]}(),function(){"use strict";function userController($scope,loginService,ngsalConfig,$state){$scope.logout=function(){loginService.logout()},$scope.changePerfil=function(perfil){},$scope.$on("event:userDetailsPrepared",function(){$scope.user=loginService.getCurrentUser().userDetails,$state.go(ngsalConfig.homePath)}),$scope.$on("event:userLogout",function(){$scope.user={}})}angular.module("ng-sal").controller("userController",userController),userController.$inject=["$scope","loginService","ngsalConfig","$state"]}(),function(){"use strict";function loginPanel(){return{restrict:"A",template:'<div block-ui block-ui-pattern="/.*/api/authentication/"><div class="form-box" id="login-box" ng-controller="loginController" ng-hide="isAuthenticated"><div class="header"><i class="fa fa-lock"></i> Área Restrita</div><form name="loginForm" autocomplete="off"><div class="body bg-gray"><div class="form-group" show-errors><input auto-focus type="text" name="username" ng-model="username" class="form-control" placeholder="Login"/><span class="help-block" ng-show="loginForm.username.$error.required">Obrigatório</span></div><div class="form-group" show-errors><input type="password" name="password" ng-model="password" class="form-control" placeholder="Senha"/><span class="help-block" ng-show="loginForm.password.$error.required">Obrigatório</span></div></div><div class="footer bg-gray"><button type="submit" ng-click="submit()" class="btn btn-primary btn-block">Autenticar</button><div class="alert alert-danger alert-dismissable" ng-show="authenticationError"><b>Usuário ou senha inválida!</b></div></div></form></div></div>'}}angular.module("ng-sal").directive("loginPanel",loginPanel)}(),function(){"use strict";function authenticatedApplication(loginService,$document,$location){return{restrict:"A",link:function(scope,elem,attrs){scope.isAuthenticated=!1,(null===loginService.getCurrentUser()||null===loginService.getCurrentUser().username||""===loginService.getCurrentUser().username)&&loginService.authenticate({},function(data){scope.isAuthenticated=!0,loginService.setUserDetails(data)},function(data){scope.isAuthenticated=!1}),elem.removeClass("waiting-for-angular"),scope.$on("event:auth-loginRequired",function(){scope.isAuthenticated=!1}),scope.$on("event:auth-loginConfirmed",function(){scope.isAuthenticated=!0}),scope.$on("event:userLogout",function(){scope.isAuthenticated=!1})}}}angular.module("ng-sal").directive("authenticatedApplication",authenticatedApplication)}(),function(){"use strict";function userPanel(){return{restrict:"A",template:'<div class="navbar-right" ng-controller="userController" ng-show="isAuthenticated"><ul class="nav navbar-nav"><li class="dropdown user user-menu"><a href="" class="dropdown-toggle" data-toggle="dropdown"> <i class="glyphicon glyphicon-user"></i></a><ul class="dropdown-menu"><li class="user-header bg-light-blue"  style="height: auto;"><p><small>{{user.login}}</small></p><p>{{user.nome}}<small>Perfil: {{user.perfil}}</small></p></li><li class="user-footer"><div class="pull-right"><a href="" ng-click="logout()" class="btn btn-danger" style="color:white;"> Sair</a></div></li></ul></li></ul></div>'}}angular.module("ng-sal").directive("userPanel",userPanel)}();