{"version":3,"sources":["main.js","constant.config.js","login.service.js","login.controller.js","user.controller.js","login-panel.directive.js","authenticated-application.directive.js","user-panel.directive.js"],"names":["angular","module","constant","applicationName","applicationHomePath","applicationApiVersion","loginService","$resource","authService","$rootScope","ngsalConfig","service","apiVersion","username","password","login","method","isArray","headers","Content-Type","ignoreAuthModule","logoutApi","url","authenticate","user","goToPerfil","params","codigo","currentUser","getCurrentUser","activateLogin","obj","permissions","userDetails","setUserDetails","loginConfirmed","logout","data","loginCancelled","success","$broadcast","factory","$inject","loginController","$scope","$document","$sanitize","sanitizeCredentials","btoa","unescape","encodeURIComponent","limpaForm","authenticationError","submit","controller","userController","$state","changePerfil","perfil","$on","go","homePath","loginPanel","restrict","template","directive","authenticatedApplication","$location","link","scope","elem","attrs","isAuthenticated","removeClass","userPanel"],"mappings":"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","file":"ng-sal.min.js","sourcesContent":["(function () {\n  'use strict';\n\n  angular.module('ng-sal', ['http-auth-interceptor', 'ui.router']);\n\n})();\n","(function () {\n  'use strict';\n\n  angular.module('ng-sal').constant('ngsalConfig', {\n      applicationName: 'ngsalConfig.applicationName',\n      applicationHomePath : 'ngsalConfig.homePath',\n      applicationApiVersion: 'ngsalConfig.apiVersion'\n  });\n\n})();\n","(function () {\n  'use strict';\n\n  angular.module('ng-sal').factory('loginService', loginService);\n\n  loginService.$inject = ['$resource', 'authService', '$rootScope', 'ngsalConfig'];\n\n  function loginService ($resource, authService, $rootScope, ngsalConfig) {\n      var service = $resource('/' + ngsalConfig.applicationName + '/api/' + ngsalConfig.apiVersion + '/authentication', {\n          'username': '@username',\n          'password': '@password'\n      }, {\n          'login': {\n              method: 'POST',\n              isArray: false,\n              headers: {'Content-Type': 'application/x-www-form-urlencoded'},\n              ignoreAuthModule: 'ignoreAuthModule'\n          },\n          'logoutApi': {\n              method: 'GET',\n              url: '/' + ngsalConfig.applicationName + '/api/' + ngsalConfig.apiVersion + '/logout',\n              isArray: true,\n              ignoreAuthModule: 'ignoreAuthModule'\n          },\n          'authenticate': {\n              method: 'GET',\n              url: '/' + ngsalConfig.applicationName + '/api/' + ngsalConfig.apiVersion + '/authenticate',\n              isArray: false,\n              ignoreAuthModule: 'ignoreAuthModule'\n          },\n          'user': {\n              method: 'GET',\n              url: '/' + ngsalConfig.applicationName + '/api/' + ngsalConfig.apiVersion + '/user',\n              isArray: false\n          },\n          'goToPerfil': {\n              method: 'GET',\n              url: '/' + ngsalConfig.applicationName + '/api/' + ngsalConfig.apiVersion + '/goToPerfil/:codigo',\n              params: {codigo: '@codigo'},\n              isArray: false\n          }\n      });\n\n      var currentUser = null;\n\n      service.getCurrentUser = function () {\n          return currentUser;\n      };\n\n      service.activateLogin = function (obj) {\n          currentUser = {username: obj.username, permissions: {}, userDetails: {}};\n          service.authenticate({}, function (userDetails) {\n              service.setUserDetails(userDetails);\n              authService.loginConfirmed(obj);\n          });\n\n      };\n\n      service.logout = function (data) {\n          authService.loginCancelled(data);\n          currentUser = null;\n          service.logoutApi(function (success) {\n              $rootScope.$broadcast('event:userLogout');\n          });\n\n      };\n\n      service.setUserDetails = function (data) {\n          if (!currentUser) currentUser = {username: data.username, permissions: {}, userDetails: {}};\n          currentUser.userDetails = data.userDetails;\n          currentUser.permissions = data.permissions;\n          $rootScope.currentUser = currentUser;\n          $rootScope.$broadcast('event:userDetailsPrepared');\n      };\n\n      return service;\n  }\n\n})();\n","(function () {\n  'use strict';\n\n  angular.module('ng-sal').controller('loginController', loginController);\n\n  loginController.$inject = ['$scope', 'loginService', 'authService', '$document', '$sanitize'];\n\n  function loginController ($scope, loginService, authService, $document, $sanitize) {\n\n      $scope.authenticationError = false;\n\n      function sanitizeCredentials() {\n          return {\n              username: $sanitize($scope.username),\n              password: btoa(unescape(encodeURIComponent($scope.password))),\n              ignoreAuthModule: 'ignoreAuthModule'\n          };\n      }\n\n      $scope.submit = function () {\n\n          $scope.authenticationError = false;\n\n          loginService.login(sanitizeCredentials(),\n              function (data) {\n                  loginService.activateLogin(data);\n                  limpaForm();\n              }, function (data) {\n                  loginService.logout(data);\n                  limpaForm();\n                  $scope.authenticationError = true;\n              });\n      };\n\n      function limpaForm() {\n          $scope.username = null;\n          $scope.password = null;\n\n      }\n\n  }\n\n})();\n","(function () {\n  'use strict';\n\n  angular.module('ng-sal').controller('userController', userController);\n\n  userController.$inject = ['$scope', 'loginService', 'ngsalConfig', '$state'];\n\n  function userController ($scope, loginService,ngsalConfig, $state) {\n\n      $scope.logout = function () {\n          loginService.logout();\n      };\n\n      $scope.changePerfil = function (perfil) {\n          //TODO: depende de alteração do sca\n      };\n\n      $scope.$on('event:userDetailsPrepared', function () {\n          $scope.user = loginService.getCurrentUser().userDetails;\n          $state.go(ngsalConfig.homePath);\n      });\n\n      $scope.$on('event:userLogout', function () {\n          $scope.user = {};\n      });\n\n  }\n\n})();\n","(function () {\n  'use strict';\n\n  angular.module('ng-sal').directive('loginPanel', loginPanel);\n\n  loginPanel.$inject = ['ngsalConfig'];\n\n  function loginPanel (ngsalConfig) {\n      return {\n          restrict: 'A',\n          template: '<div block-ui block-ui-pattern=\"/.*\\/api\\/' + ngsalConfig.apiVersion + '\\/authentication/\"><div class=\"form-box\" id=\"login-box\" ng-controller=\"loginController\" ng-hide=\"isAuthenticated\"><div class=\"header\"><i class=\"fa fa-lock\"></i> Área Restrita</div><form name=\"loginForm\" autocomplete=\"off\"><div class=\"body bg-gray\"><div class=\"form-group\" show-errors><input auto-focus type=\"text\" name=\"username\" ng-model=\"username\" class=\"form-control\" placeholder=\"Login\"/><span class=\"help-block\" ng-show=\"loginForm.username.$error.required\">Obrigatório</span></div><div class=\"form-group\" show-errors><input type=\"password\" name=\"password\" ng-model=\"password\" class=\"form-control\" placeholder=\"Senha\"/><span class=\"help-block\" ng-show=\"loginForm.password.$error.required\">Obrigatório</span></div></div><div class=\"footer bg-gray\"><button type=\"submit\" ng-click=\"submit()\" class=\"btn btn-primary btn-block\">Autenticar</button><div class=\"alert alert-danger alert-dismissable\" ng-show=\"authenticationError\"><b>Usuário ou senha inválida!</b></div></div></form></div></div>'\n      }\n  }\n\n})();\n","(function () {\n  'use strict';\n\n  angular.module('ng-sal').directive('authenticatedApplication', authenticatedApplication);\n\n  authenticatedApplication.$inject = ['loginService', '$document', '$location'];\n\n  function authenticatedApplication (loginService, $document, $location) {\n      return {\n          restrict: 'A',\n          link: function (scope, elem, attrs) {\n\n              scope.isAuthenticated = false;\n\n              if (loginService.getCurrentUser() === null || loginService.getCurrentUser().username === null || loginService.getCurrentUser().username === '') {\n                  loginService.authenticate({}, function (data) {\n                      scope.isAuthenticated = true;\n                      loginService.setUserDetails(data);\n                  }, function (data) {\n                      scope.isAuthenticated = false;\n                  });\n              }\n              elem.removeClass('waiting-for-angular');\n\n              scope.$on('event:auth-loginRequired', function () {\n                  scope.isAuthenticated = false;\n              });\n              scope.$on('event:auth-loginConfirmed', function () {\n                  scope.isAuthenticated = true;\n              });\n              scope.$on('event:userLogout', function () {\n                  scope.isAuthenticated = false;\n              });\n          }\n      }\n  }\n\n})();\n","(function () {\n  'use strict';\n\n  angular.module('ng-sal').directive('userPanel', userPanel);\n\n  function userPanel () {\n      return {\n          restrict: 'A',\n          template:\n          '<div class=\"navbar-right\" ng-controller=\"userController\" ng-show=\"isAuthenticated\">' +\n              '<ul class=\"nav navbar-nav\">' +\n                  '<li class=\"dropdown user user-menu\">' +\n                      '<a href=\"\" class=\"dropdown-toggle\" data-toggle=\"dropdown\"> <i class=\"glyphicon glyphicon-user\"></i></a>' +\n                      '<ul class=\"dropdown-menu\">' +\n                          '<li class=\"user-header bg-light-blue\"  style=\"height: auto;\"><p><small>{{user.login}}</small></p><p>{{user.nome}}<small>Perfil: {{user.perfil}}</small></p></li>' +\n                          '<li class=\"user-footer\"><div class=\"pull-right\"><a href=\"\" ng-click=\"logout()\" class=\"btn btn-danger\" style=\"color:white;\"> Sair</a></div></li>' +\n                      '</ul>' +\n                  '</li>' +\n              '</ul>' +\n          '</div>'\n      }\n  }\n\n})();\n"]}